#!/usr/bin/python3

from sys import argv
from os import system
from subprocess import check_call

print (argv)

def call(*args):
    try:
        check_call(args)
    except Exception as e:
        print (str(e))

if argv[1] == 'serve':
    commit = False
    print ("No commit")
else:
    commit = argv[1]
system("mkdir resources")
system ("cp -r _resources/* resources")
system('./SimplePreprocessor/spp -s "_posts"')
try:
    system('find resources -name *.svg -exec inkscape -z {} -e {}.png \;')
    system ('_scripts/indexresources.py')
except Exception:
    pass
if commit:
    system('jekyll build')
    system('git add .')
    system('git add -u')
    call('git', 'commit', '-m', commit)
    system('git push origin master')
else:
    system('jekyll serve')

system('./SimplePreprocessor/spp -s "_posts" -c')

try:
    system ('_scripts/indexresources.py clean')
    system ("rm -r resources")
except Exception as e:
    print (e)

if commit:
    system('git add .')
    system('git add -u')
    system('git status')
    call('git', 'commit', '-m', commit.replace("\"", "")
            + ' (Saving actual state of my computer so git diff works;'
            + ' cannot push because that breaks the website.)')
